<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login - Website EMAS</title>
    <link
      rel="shortcut icon"
      type="image/png"
      href="/public/images/logos/Bank_Syariah_Indonesia.svg"
    />
    <link rel="stylesheet" href="/public/css/styles.min.css" />
  </head>

  <body>
    <div
      class="page-wrapper"
      id="main-wrapper"
      data-layout="vertical"
      data-navbarbg="skin6"
      data-sidebartype="full"
      data-sidebar-position="fixed"
      data-header-position="fixed"
    >
      <div
        class="position-relative overflow-hidden radial-gradient min-vh-100 d-flex align-items-center justify-content-center"
      >
        <div class="d-flex align-items-center justify-content-center w-100">
          <div class="row justify-content-center w-100">
            <div class="col-md-8 col-lg-6 col-xxl-3">
              <div class="card mb-0">
                <div class="card-body">
                  <a
                    href="/"
                    class="text-nowrap logo-img text-center d-block py-3 w-100"
                  >
                    <img
                      src="/public/images/logos/Bank_Syariah_Indonesia.svg"
                      alt="Bank Syariah Indonesia"
                      style="
                        height: 40px;
                        width: auto;
                        margin: 0 auto;
                        display: block;
                      "
                    />
                    <span class="brand-text fw-semibold fs-4 ms-1 d-block mt-2"
                      >BSIMOMS</span
                    >
                  </a>
                  <p class="text-center">Silakan login untuk melanjutkan</p>

                  <!-- Alert untuk error/success message -->
                  <div
                    id="alertMessage"
                    class="alert alert-dismissible fade"
                    role="alert"
                    style="display: none"
                  >
                    <span id="alertText"></span>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="alert"
                      aria-label="Close"
                    ></button>
                  </div>

                  <form id="loginForm">
                    <div class="mb-3">
                      <label for="emailInput" class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control"
                        id="emailInput"
                        name="email"
                        placeholder="email@example.com"
                        required
                      />
                    </div>
                    <div class="mb-4">
                      <label for="passwordInput" class="form-label"
                        >Password</label
                      >
                      <input
                        type="password"
                        class="form-control"
                        id="passwordInput"
                        name="password"
                        placeholder="Masukkan password"
                        required
                      />
                    </div>
                    <div
                      class="d-flex align-items-center justify-content-between mb-4"
                    >
                      <div class="form-check">
                        <input
                          class="form-check-input primary"
                          type="checkbox"
                          value=""
                          id="rememberMe"
                        />
                        <label
                          class="form-check-label text-dark"
                          for="rememberMe"
                          >Ingat saya</label
                        >
                      </div>
                      <a class="text-primary fw-bold" href="#"
                        >Lupa Password?</a
                      >
                    </div>
                    <button
                      type="submit"
                      class="btn btn-primary w-100 py-8 fs-4 mb-4"
                      id="loginButton"
                    >
                      <span id="loginButtonText">Sign In</span>
                      <span
                        id="loginSpinner"
                        class="spinner-border spinner-border-sm ms-2"
                        role="status"
                        aria-hidden="true"
                        style="display: none"
                      ></span>
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="/public/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>

    <script>
      // Handle login form submission
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const email = document.getElementById("emailInput").value;
          const password = document.getElementById("passwordInput").value;
          const loginButton = document.getElementById("loginButton");
          const loginButtonText = document.getElementById("loginButtonText");
          const loginSpinner = document.getElementById("loginSpinner");

          // Disable button dan show loading
          loginButton.disabled = true;
          loginButtonText.textContent = "Logging in...";
          loginSpinner.style.display = "inline-block";

          try {
            const response = await fetch("/api/auth/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email, password }),
            });

            const data = await response.json();

            if (data.success) {
              // Show success message
              showAlert("success", data.message);

              // Redirect ke dashboard setelah 1 detik
              setTimeout(() => {
                window.location.href = data.redirect || "/dashboard";
              }, 1000);
            } else {
              // Show error message
              showAlert("danger", data.message);

              // Enable button kembali
              loginButton.disabled = false;
              loginButtonText.textContent = "Sign In";
              loginSpinner.style.display = "none";
            }
          } catch (error) {
            console.error("Login error:", error);
            showAlert(
              "danger",
              "Terjadi kesalahan saat login. Silakan coba lagi."
            );

            // Enable button kembali
            loginButton.disabled = false;
            loginButtonText.textContent = "Sign In";
            loginSpinner.style.display = "none";
          }
        });

      // Function untuk show alert message
      function showAlert(type, message) {
        const alertDiv = document.getElementById("alertMessage");
        const alertText = document.getElementById("alertText");

        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertText.textContent = message;
        alertDiv.style.display = "block";

        // Auto hide setelah 5 detik
        setTimeout(() => {
          alertDiv.style.display = "none";
        }, 5000);
      }

      // Auto fill form jika ada remember me di localStorage
      window.addEventListener("load", function () {
        const rememberedEmail = localStorage.getItem("rememberedEmail");
        if (rememberedEmail) {
          document.getElementById("emailInput").value = rememberedEmail;
          document.getElementById("rememberMe").checked = true;
        }
      });

      // Save email jika remember me checked
      document
        .getElementById("rememberMe")
        .addEventListener("change", function () {
          const email = document.getElementById("emailInput").value;
          if (this.checked && email) {
            localStorage.setItem("rememberedEmail", email);
          } else {
            localStorage.removeItem("rememberedEmail");
          }
        });
    </script>
  </body>
</html>
