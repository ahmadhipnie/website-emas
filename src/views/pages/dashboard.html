<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard - Website EMAS</title>
    <link
      rel="icon"
      href="/public/images/logos/Bank_Syariah_Indonesia.svg"
      type="image/svg+xml"
    />
    <link rel="stylesheet" href="/public/css/styles.min.css" />
    <link rel="stylesheet" href="/public/css/spa-transitions.css" />
    
    <!-- DataTables CSS (untuk management users) -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
  </head>

  <body>
    <!--  Body Wrapper -->
    <div
      class="page-wrapper"
      id="main-wrapper"
      data-layout="vertical"
      data-navbarbg="skin6"
      data-sidebartype="full"
      data-sidebar-position="fixed"
      data-header-position="fixed"
    >
      <!-- Sidebar Container - Loaded dynamically -->
      <div id="sidebar-container"></div>
      <!--  Sidebar End -->

      <!--  Main wrapper -->
      <div class="body-wrapper">
        <!-- Header Container - Loaded dynamically -->
        <div id="header-container"></div>
        <!--  Header End -->

        <div class="container-fluid">
          <!-- Gold Price Header -->
          <div class="row mb-4">
            <div class="col-12">
              <div
                class="d-flex justify-content-between align-items-center flex-wrap gap-3"
              >
                <div>
                  <h4 class="fw-semibold mb-1">Harga Emas Hari Ini</h4>
                  <p class="mb-0 text-muted fs-4">
                    Update terakhir: <span id="last-update">-</span>
                  </p>
                  <!-- manual refresh status removed -->
                </div>
                <div class="d-flex gap-2">
                  <button
                    id="toggle-unit-btn"
                    class="btn btn-outline-secondary"
                  >
                    Tampilkan per Gram
                  </button>
                  <button id="refresh-gold-btn" class="btn btn-primary">
                    <iconify-icon
                      icon="solar:refresh-bold"
                      class="fs-5"
                    ></iconify-icon>
                    Refresh
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Gold Price Cards -->
          <div class="row">
            <!-- Main Price Card -->
            <div class="col-12 col-sm-6 col-xl-3 mb-3 mb-xl-0">
              <div
                class="card border-primary border-opacity-10 shadow-primary shadow-0 h-100"
              >
                <div
                  class="card-body d-flex flex-column justify-content-between"
                >
                  <div
                    class="d-flex align-items-center justify-content-between"
                  >
                    <div class="d-flex align-items-center gap-3">
                      <div
                        class="bg-primary bg-opacity-10 rounded-3 p-3 d-flex align-items-center justify-content-center"
                      >
                        <iconify-icon
                          icon="solar:coins-bold-duotone"
                          class="fs-2 text-primary"
                        ></iconify-icon>
                      </div>
                      <div>
                        <h6 class="mb-1 text-muted">Harga Emas (Spot)</h6>
                        <span
                          class="badge bg-primary bg-opacity-10 text-primary fs-6"
                          id="unit-badge"
                          >/toz</span
                        >
                      </div>
                    </div>
                    <div class="text-end">
                      <small class="text-muted">&nbsp;</small>
                    </div>
                  </div>

                  <div class="mt-3">
                    <h3 class="fw-semibold mb-0" id="gold-price">-</h3>
                    <div
                      id="price-change"
                      class="d-flex align-items-center mt-2"
                    >
                      <span class="text-muted">Memuat data...</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Ask Price -->
            <div class="col-6 col-sm-3 col-xl mb-3 mb-xl-0">
              <div class="card border-success border-opacity-10 h-100">
                <div
                  class="card-body d-flex flex-column justify-content-between"
                >
                  <div
                    class="d-flex align-items-center justify-content-between"
                  >
                    <div>
                      <h6 class="mb-1 text-muted">Ask (Jual)</h6>
                    </div>
                    <div class="bg-success bg-opacity-10 rounded-3 p-2">
                      <iconify-icon
                        icon="solar:sale-bold-duotone"
                        class="fs-4 text-success"
                      ></iconify-icon>
                    </div>
                  </div>
                  <h5 class="fw-bold mb-0 text-success mt-auto" id="gold-ask">
                    -
                  </h5>
                </div>
              </div>
            </div>

            <!-- Bid Price -->
            <div class="col-6 col-sm-3 col-xl mb-3 mb-xl-0">
              <div class="card border-info border-opacity-10 h-100">
                <div
                  class="card-body d-flex flex-column justify-content-between"
                >
                  <div
                    class="d-flex align-items-center justify-content-between"
                  >
                    <div>
                      <h6 class="mb-1 text-muted">Bid (Beli)</h6>
                    </div>
                    <div class="bg-info bg-opacity-10 rounded-3 p-2">
                      <iconify-icon
                        icon="solar:cart-check-bold-duotone"
                        class="fs-4 text-info"
                      ></iconify-icon>
                    </div>
                  </div>
                  <h5 class="fw-bold mb-0 text-info mt-auto" id="gold-bid">
                    -
                  </h5>
                </div>
              </div>
            </div>

            <!-- High Price -->
            <div class="col-6 col-sm-3 col-xl mb-3 mb-xl-0">
              <div class="card border-success border-opacity-10 h-100">
                <div
                  class="card-body d-flex flex-column justify-content-between"
                >
                  <div
                    class="d-flex align-items-center justify-content-between"
                  >
                    <div>
                      <h6 class="mb-1 text-muted">Tertinggi</h6>
                    </div>
                    <div class="bg-success bg-opacity-10 rounded-3 p-2">
                      <iconify-icon
                        icon="solar:arrow-up-bold-duotone"
                        class="fs-4 text-success"
                      ></iconify-icon>
                    </div>
                  </div>
                  <h5 class="fw-bold mb-0 text-success mt-auto" id="gold-high">
                    -
                  </h5>
                </div>
              </div>
            </div>

            <!-- Low Price -->
            <div class="col-6 col-sm-3 col-xl mb-3 mb-xl-0">
              <div class="card border-danger border-opacity-10 h-100">
                <div
                  class="card-body d-flex flex-column justify-content-between"
                >
                  <div
                    class="d-flex align-items-center justify-content-between"
                  >
                    <div>
                      <h6 class="mb-1 text-muted">Terendah</h6>
                    </div>
                    <div class="bg-danger bg-opacity-10 rounded-3 p-2">
                      <iconify-icon
                        icon="solar:arrow-down-bold-duotone"
                        class="fs-4 text-danger"
                      ></iconify-icon>
                    </div>
                  </div>
                  <h5 class="fw-bold mb-0 text-danger mt-auto" id="gold-low">
                    -
                  </h5>
                </div>
              </div>
            </div>
          </div>

          <!-- API Usage Card -->
          <div class="row mb-4 my-4">
            <div class="col-12">
              <div class="card border-warning border-opacity-10">
                <div class="card-body">
                  <div
                    class="d-flex justify-content-between align-items-center flex-wrap gap-3"
                  >
                    <div class="d-flex align-items-center gap-3">
                      <div class="bg-warning bg-opacity-10 rounded-circle p-2">
                        <iconify-icon
                          icon="solar:chart-pie-bold-duotone"
                          class="fs-4 text-warning"
                        ></iconify-icon>
                      </div>
                      <div>
                        <h6 class="mb-0 text-muted">API Usage (metals.dev)</h6>
                        <small class="text-muted" id="api-plan"
                          >Memuat...</small
                        >
                      </div>
                    </div>
                    <div class="flex-grow-1" style="max-width: 400px">
                      <div class="d-flex justify-content-between mb-1">
                        <span class="small text-muted" id="api-usage-text"
                          >-</span
                        >
                        <span class="small fw-semibold" id="api-remaining"
                          >-</span
                        >
                      </div>
                      <div class="progress" style="height: 8px">
                        <div
                          id="api-usage-bar"
                          class="progress-bar bg-warning"
                          role="progressbar"
                          style="width: 0%"
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Gold Price Chart -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <div
                    class="d-flex justify-content-between align-items-center mb-4"
                  >
                    <h5 class="card-title mb-0">
                      <iconify-icon
                        icon="solar:chart-bold-duotone"
                        class="fs-5 me-2 text-primary"
                      ></iconify-icon>
                      Grafik Harga Spot, Ask & Bid (10 Hari Terakhir)
                    </h5>
                    <span
                      class="badge bg-secondary bg-opacity-10 text-secondary"
                      >Live</span
                    >
                  </div>
                  <div id="gold-chart-container">
                    <div id="gold-price-chart"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Leads Management Summary -->
          <div class="row mb-4">
            <!-- Total Leads -->
            <div class="col-12 col-sm-6 col-xl-3 mb-3 mb-xl-0">
              <div class="card border-primary border-opacity-10 shadow-primary shadow-0 h-100">
                <div class="card-body d-flex flex-column justify-content-between">
                  <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-3">
                      <div class="bg-primary bg-opacity-10 rounded-3 p-3 d-flex align-items-center justify-content-center">
                        <iconify-icon icon="solar:users-group-rounded-bold-duotone" class="fs-2 text-primary"></iconify-icon>
                      </div>
                      <div>
                        <h6 class="mb-1 text-muted">Total Leads</h6>
                      </div>
                    </div>
                  </div>
                  <div class="mt-3">
                    <h3 class="fw-semibold mb-0" id="total-leads-count">-</h3>
                    <small class="text-muted">Semua nasabah</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Dynamic Status Cards -->
            <div class="leads-summary-cards col-12 col-sm-6 col-xl-9 mb-3 mb-xl-0">
              <!-- Cards will be rendered dynamically by JavaScript -->
              <div class="row">
                <div class="col-6 col-sm-3 col-xl mb-3 mb-xl-0">
                  <div class="card border-secondary border-opacity-10 h-100 opacity-50">
                    <div class="card-body d-flex flex-column justify-content-between">
                      <div class="d-flex align-items-center justify-content-between">
                        <div>
                          <h6 class="mb-1 text-muted">-</h6>
                        </div>
                        <div class="bg-secondary bg-opacity-10 rounded-3 p-2">
                          <iconify-icon icon="solar:shield-bold-duotone" class="fs-4 text-secondary"></iconify-icon>
                        </div>
                      </div>
                      <h5 class="fw-bold mb-0 text-secondary mt-auto">0</h5>
                    </div>
                  </div>
                </div>
                <div class="col-6 col-sm-3 col-xl mb-3 mb-xl-0">
                  <div class="card border-secondary border-opacity-10 h-100 opacity-50">
                    <div class="card-body d-flex flex-column justify-content-between">
                      <div class="d-flex align-items-center justify-content-between">
                        <div>
                          <h6 class="mb-1 text-muted">-</h6>
                        </div>
                        <div class="bg-secondary bg-opacity-10 rounded-3 p-2">
                          <iconify-icon icon="solar:shield-bold-duotone" class="fs-4 text-secondary"></iconify-icon>
                        </div>
                      </div>
                      <h5 class="fw-bold mb-0 text-secondary mt-auto">0</h5>
                    </div>
                  </div>
                </div>
                <div class="col-6 col-sm-3 col-xl mb-3 mb-xl-0">
                  <div class="card border-secondary border-opacity-10 h-100 opacity-50">
                    <div class="card-body d-flex flex-column justify-content-between">
                      <div class="d-flex align-items-center justify-content-between">
                        <div>
                          <h6 class="mb-1 text-muted">-</h6>
                        </div>
                        <div class="bg-secondary bg-opacity-10 rounded-3 p-2">
                          <iconify-icon icon="solar:shield-bold-duotone" class="fs-4 text-secondary"></iconify-icon>
                        </div>
                      </div>
                      <h5 class="fw-bold mb-0 text-secondary mt-auto">0</h5>
                    </div>
                  </div>
                </div>
                <div class="col-6 col-sm-3 col-xl mb-3 mb-xl-0">
                  <div class="card border-secondary border-opacity-10 h-100 opacity-50">
                    <div class="card-body d-flex flex-column justify-content-between">
                      <div class="d-flex align-items-center justify-content-between">
                        <div>
                          <h6 class="mb-1 text-muted">-</h6>
                        </div>
                        <div class="bg-secondary bg-opacity-10 rounded-3 p-2">
                          <iconify-icon icon="solar:shield-bold-duotone" class="fs-4 text-secondary"></iconify-icon>
                        </div>
                      </div>
                      <h5 class="fw-bold mb-0 text-secondary mt-auto">0</h5>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Leads Table -->
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="card-title fw-semibold mb-0">
                      <iconify-icon icon="solar:users-group-rounded-bold-duotone" class="fs-5 me-2 text-primary"></iconify-icon>
                      Daftar Leads Terbaru
                    </h5>
                    <a href="/lead-management" class="btn btn-primary">
                      <i class="ti ti-arrow-right"></i> Lihat Semua
                    </a>
                  </div>

                  <div class="table-responsive">
                    <table id="dashboardLeadsTable" class="table table-hover table-striped" style="width:100%">
                      <thead>
                        <tr>
                          <th>Nama Nasabah</th>
                          <th>No. HP</th>
                          <th>Produk</th>
                          <th>Status</th>
                          <th>Tanggal Input</th>
                        </tr>
                      </thead>
                      <tbody id="dashboardLeadsTableBody">
                        <tr>
                          <td colspan="5" class="text-center text-muted">
                            <div class="spinner-border spinner-border-sm me-2" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                            Memuat data...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <!-- Flyer Carousel Section -->
            <div id="flyer-carousel-container">
              <!-- Flyer carousel will be loaded here dynamically -->
              <div class="row">
                <div class="col-12 text-center py-5">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p class="text-muted mt-3">Memuat flyer...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Footer Component -->
      <div id="footer-container"></div>
    </div>

    <script src="/public/libs/jquery/dist/jquery.min.js"></script>
    <script src="/public/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/public/libs/apexcharts/dist/apexcharts.min.js"></script>
    <script src="/public/libs/simplebar/dist/simplebar.js"></script>
    
    <!-- DataTables (untuk management users) -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    
    <script src="/public/js/app.min.js"></script>
    <script src="/public/js/dashboard.js"></script>
    <script src="/public/js/management-users.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>

    <!-- Gold Price Dashboard -->
    <script src="/public/js/gold-dashboard.js"></script>

    <!-- Dashboard Leads -->
    <script src="/public/js/dashboard-leads.js"></script>

    <!-- Flyer Carousel -->
    <script src="/public/js/dashboard-flyer-carousel.js"></script>

    <!-- MVC Integration -->
    <script type="module" src="/src/app.js"></script>
  
    <!-- Components Loader -->
    <script src="/public/js/components-loader.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        loadCommonComponents();
      });
    </script>
  </body>
</html>
